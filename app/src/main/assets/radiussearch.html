<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Openweathermap</title>

<link type="text/css" rel="stylesheet" href="leaflet.css" />
<link rel="stylesheet" type="text/css" href="leaflet-openweathermap.css" />


<script type="text/javascript" src="leaflet.js"></script>
<script type="text/javascript" src="leaflet-openweathermap.js"></script>

</head>


<body>

<!-- mapbox -->
<div id="map" style="position: absolute; top: 0px; left: 0; bottom: 0; right: 0;"></div>>
<!-- routing -->


<br>
<!-- links !-->


<!-- custom script!-->
<script>
var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
        };
        
/**
 Get Lat / Lon from Openweather API
*/
var owmreq = new XMLHttpRequest();
    owmreq.open("GET", "https://api.openweathermap.org/data/2.5/weather?id=" + getUrlParameter('cityid') + "&appid=" + getUrlParameter('appid'), false); //false means wait until http request is finished
    owmreq.onload = function(e) {
         weatherdata = JSON.parse(owmreq.response);
     };
   owmreq.send(); 

initMap();

var map;

function initMap() {
var OWM_API_KEY = getUrlParameter('appid');

	var standard = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 19,
		attribution: '<a href="https://leafletjs.com/" target="_blank">Leaflet</a> | &copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors</a>'
		});

	var city = L.OWM.current({intervall: 15,  minZoom: 5,
			appId: OWM_API_KEY});

	var zoom = 9;
	var lat = weatherdata.coord.lat;
	var lon = weatherdata.coord.lon;

	map = L.map('map', {
		center: new L.LatLng(lat, lon), zoom: zoom,
		layers: [standard,city]
	});
	map.attributionControl.setPrefix("");

}

</script>
</body>
</html>
